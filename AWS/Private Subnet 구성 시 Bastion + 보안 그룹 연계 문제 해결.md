## Private Subnet 구성 시 Bastion + 보안 그룹 연계 문제 해결

### 문제 상황

AWS 환경에서 RDS Custom 인스턴스를 **Private Subnet**에 구성한 상태에서, Agent 설치 후 정책 서버 와의 통신이 되지 않았음.

### 원인 분석

- **Private Subnet 특성상 외부 접근이 불가**하여, Bastion 서버를 통한 SSH 2-hop 접속이 필요했음
- 하지만 **에이전트 → 정책 서버(PS)** 간 통신은 실패
- 원인은 **보안 그룹 인바운드에서 포트 9908 누락**이었음 (정책 서버 통신 포트)

### 해결 과정

1. Bastion 서버를 통해 RDS에 SSH 2단계 접속

   ```
   ssh -i bastion.pem ec2-user@<bastion-public-ip>
   ssh -i rds.pem ec2-user@<rds-private-ip>
   ```

2. 에이전트 로그를 통해 정책 수신 실패 확인

3. RDS 인스턴스에 연결된 보안 그룹 `ks-sg-rds-an2`의 인바운드 규칙에 다음 추가:

   - 포트: `대상 포트`
   - 프로토콜: TCP
   - 소스: 정책 서버 보안 그룹

4. 수정 후 정책 수신 및 연동 정상 확인

### 배운 점

- **Private Subnet에 인스턴스를 구성하면, 네트워크 통신 문제는 보안 그룹 + 라우팅 구조까지 모두 고려해야 함**
- SSH 접속은 Bastion으로 가능하지만, **서비스 간 통신은 인바운드/아웃바운드 보안 그룹에 따라 전혀 다르게 작동**함
- 특히 **보안 에이전트, 정책 서버 연동처럼 양방향 통신이 필요한 경우 포트 개방이 필수**

### 정리

- Private Subnet 구성 시, **운영 포트 리스트를 미리 정의**하고 보안 그룹에 선반영할 것
- Bastion 접근 구조와 보안 그룹 구조는 항상 함께 문서화해서 관리