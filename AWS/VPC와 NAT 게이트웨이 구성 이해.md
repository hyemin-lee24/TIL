# VPC와 NAT 게이트웨이 구성 이해

### VPC (Virtual Private Cloud)

- AWS 상의 **사용자 전용 네트워크 환경**.
- 서브넷, 라우팅 테이블, IGW, NAT Gateway 등 다양한 리소스를 구성 가능.
- 보안 및 트래픽 흐름을 세밀하게 제어할 수 있어 **마이크로 서비스 아키텍처**에서 특히 중요.

---

### Subnet

- VPC 내 IP 대역을 구분한 논리적 네트워크.
- 유형:
    - **퍼블릭 서브넷**: IGW(Internet Gateway)를 통해 외부 통신이 가능한 서브넷.
    - **프라이빗 서브넷**: IGW 접근 불가. 외부와 직접 통신하지 않음.

---

### 라우팅 테이블

- 서브넷의 트래픽 흐름을 제어하는 정책 집합.
- 주요 설정:
    - 퍼블릭 서브넷 → IGW
    - 프라이빗 서브넷 → NAT Gateway

---

### 인터넷 게이트웨이 (IGW)

- VPC와 퍼블릭 인터넷 간의 양방향 트래픽을 중계.
- IGW가 연결된 라우팅 테이블을 가진 서브넷만 외부 인터넷 접근 가능.

---

### NAT Gateway

- 프라이빗 서브넷 내 인스턴스가 **아웃바운드 트래픽**을 허용받기 위한 중계자.
- **인바운드 트래픽은 차단**되어 보안성이 높음.
- 사용 시점: 예) 프라이빗 서브넷 EC2가 `yum update`, 외부 API 호출 등 수행할 때.

### 유형 비교

| 유형 | 설명 |
| --- | --- |
| **퍼블릭 NAT 게이트웨이** | - 퍼블릭 서브넷에 배치- EIP 필요- IGW 경유로 인터넷 통신 가능 |
| **프라이빗 NAT 게이트웨이** | - 외부 인터넷 연결 불가- 온프레미스/다른 VPC 통신에 적합- IGW 연결 시 트래픽 드롭됨 |

### 주소 변환 흐름

- `Private EC2 → NAT GW(프라이빗 IP) → EIP → 인터넷`
- 응답은 NAT Gateway를 거쳐 원래 인스턴스로 복원 전달됨.

---

### 주의할 점

- **NAT Gateway는 연결을 시작한 측에서만 통신 가능** (외부에서 NAT GW 경유한 인바운드 불가)
- IGW는 **퍼블릭 NAT와만 호환**됨.
- MTU는 **최대 8,500바이트** (패킷 크기 최적화 필요)
- 비용 고려: NAT GW는 시간당 요금 + 데이터 처리량 기준 요금 발생

---

### IPv6 환경

- NAT64 / DNS64 조합으로 IPv6 ↔ IPv4 변환 지원
- IPv6 아웃바운드 전용: **Egress-only Internet Gateway** 사용

---

### 정리

- **퍼블릭 서브넷 = 외부 서비스와 직접 통신 가능**
    
    → Bastion, ALB, NAT Gateway 등 배치
    
- **프라이빗 서브넷 = 외부로만 나가는 제한적 통신**
    
    → App 서버, DB, 백엔드 서비스 등 배치
    
- **NAT Gateway는 필수가 아니라 설계 선택지**
    
    → 비용, 보안, 통신 흐름 목적에 따라 적절히 구성