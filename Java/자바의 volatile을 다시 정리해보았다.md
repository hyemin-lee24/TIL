# ìë°”ì˜ `volatile`ì„ ë‹¤ì‹œ ì •ë¦¬í•´ë³´ì•˜ë‹¤  



## ğŸ§  ë©”ëª¨ë¦¬ ê°€ì‹œì„±ê³¼ happens-before ê´€ê³„



### ğŸ” ì™œ ë‹¤ì‹œ ë³´ê²Œ ë˜ì—ˆë‚˜?



5ë…„ì°¨ê°€ ë˜ë©´ì„œ ë™ì‹œì„± ë¬¸ì œë¥¼ ë‹¤ë¤„ì•¼ í•  ì¼ì´ ëŠ˜ì–´ë‚¬ë‹¤.
í•˜ì§€ë§Œ `volatile`ì„ ì •í™•íˆ ì„¤ëª…í•˜ë¼ê³  í•˜ë©´ **ë§‰ì—°í•˜ê²Œ "ê°€ì‹œì„± ë³´ì¥" ì •ë„ë¡œë§Œ ê¸°ì–µ**í•˜ê³  ìˆì—ˆìŒ. 
ì´ë²ˆ ê¸°íšŒì— **JMM(Java Memory Model)**ê³¼ í•¨ê»˜ ê°œë…ì„ ë‹¤ì‹œ ì •ë¦¬.

---

### ğŸ“Œ í•µì‹¬ ì •ë¦¬

| ê°œë…                | ì„¤ëª…                                                         |
| ------------------- | ------------------------------------------------------------ |
| ê°€ì‹œì„± (visibility) | ë³€ìˆ˜ì˜ ìµœì‹  ê°’ì´ ëª¨ë“  ìŠ¤ë ˆë“œì—ì„œ ë³´ì´ëŠ” ê²ƒ                   |
| `volatile`          | ì“°ê¸° ì‹œ ì¦‰ì‹œ main memoryë¡œ flush, <br />ì½ê¸° ì‹œ main memoryì—ì„œ ê°€ì ¸ì˜´ |
| happens-before      | A ìŠ¤ë ˆë“œê°€ `volatile`ì— ê°’ì„ ì“´ í›„ B ìŠ¤ë ˆë“œê°€ ê·¸ ê°’ì„ ì½ìœ¼ë©´, Aì˜ ì´ì „ ì‘ì—…ì€ Bì—ê²Œ ë³´ì„ |
| ì›ìì„± (atomicity)  | `volatile`ì€ ë³´ì¥í•˜ì§€ ì•ŠìŒ (`count++`ëŠ” ì—¬ì „íˆ ìœ„í—˜)         |

---

### ğŸ§ª ì‹¤ì „ ì˜ˆì œ: ìƒíƒœ í”Œë˜ê·¸ì— ì í•©

```java
class Worker extends Thread {
    private volatile boolean running = true;

    public void run() {
        while (running) {
            // ë°˜ë³µ ì‘ì—… ìˆ˜í–‰
        }
    }

    public void shutdown() {
        running = false;
    }
}
```

- `shutdown()`ì„ í˜¸ì¶œí•˜ë©´ `running`ì´ falseë¡œ ë°”ë€Œê³ ,
- `run()` ë£¨í”„ê°€ ì¢…ë£Œë¨.
- `volatile` ì—†ìœ¼ë©´ ë£¨í”„ê°€ ëë‚˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ (ê°€ì‹œì„± ë¬¸ì œ).

------

### âš ï¸ ì£¼ì˜: `volatile`ì€ ë³µí•© ì—°ì‚°ì— ë¶ˆì•ˆì „

```java
volatile int count = 0;

public void increment() {
    count++; // ìœ„í—˜! ì›ìì ì´ì§€ ì•ŠìŒ
}
```

- `++`ëŠ” read-modify-write.
- `AtomicInteger`ë‚˜ `synchronized` í•„ìš”.

------

### ğŸ’¡ ì˜ˆì œ: Double-Checked Locking (DCL)

```java
public class Singleton {
    private static volatile Singleton instance;

    public static Singleton getInstance() {
        if (instance == null) {
            synchronized (Singleton.class) {
                if (instance == null) {
                    instance = new Singleton(); // ìƒì„±ì + í• ë‹¹ ì¬ì •ë ¬ ë°©ì§€
                }
            }
        }
        return instance;
    }
}
```

- `volatile` ì—†ìœ¼ë©´ ì¬ì •ë ¬ë¡œ ì¸í•´ partially constructed ê°ì²´ê°€ ë…¸ì¶œë  ìˆ˜ ìˆìŒ.

------

### âŒ ìì£¼ í•˜ëŠ” ì˜¤í•´

| ì˜¤í•´                               | ì§„ì‹¤                              |
| ---------------------------------- | --------------------------------- |
| `volatile`ì´ë©´ ë™ê¸°í™” ì•ˆ í•´ë„ ëœë‹¤ | ë³µí•© ì—°ì‚°ì—” ë¶ˆì¶©ë¶„                |
| í•­ìƒ lockë³´ë‹¤ ë¹ ë¥´ë‹¤               | ì¼€ì´ìŠ¤ì— ë”°ë¼ lockì´ ë” ë¹ ë¥¼ ìˆ˜ë„ |
| ëª¨ë“  ë©€í‹°ìŠ¤ë ˆë“œ ë¬¸ì œë¥¼ í•´ê²°í•´ì¤€ë‹¤  | ëŒ€ë¶€ë¶„ì€ ë¶ˆê°€ëŠ¥                   |



------

### âœ… ì •ë¦¬

- `volatile`ì€ **ë™ì‹œì„± íˆ´ë°•ìŠ¤ ì¤‘ í•˜ë‚˜ì¼ ë¿**, ë§ŒëŠ¥ì€ ì•„ë‹˜.
- ì •í™•í•œ ì‚¬ìš© ì‹œì ì€ ë‹¤ìŒê³¼ ê°™ìŒ:
  - ë‹¨ìˆœ ìƒíƒœ ê³µìœ 
  - í”Œë˜ê·¸ ì „ë‹¬
  - ì´ˆê¸°í™”ëœ ê°ì²´ì˜ ì•ˆì „í•œ ê³µê°œ